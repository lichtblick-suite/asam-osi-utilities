# SPDX-License-Identifier: MPL-2.0
# Copyright (c) 2026, Bayerische Motoren Werke Aktiengesellschaft (BMW AG)
name: REUSE Compliance

on:
  pull_request:

jobs:
  reuse-lint:
    name: REUSE Lint
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v6
      - name: Provide SPDX license text
        shell: bash
        run: |
          mkdir -p LICENSES
          cp LICENSE LICENSES/MPL-2.0.txt
      - name: Install reuse tool
        shell: bash
        run: |
          python3 -m pip install --user reuse
      - name: REUSE lint (expected success)
        shell: bash
        run: |
          python3 -m reuse lint --suppress-deprecation
      - name: Enable invalid SPDX test file
        shell: bash
        run: |
          python3 - <<'PY'
          from pathlib import Path
          dep5 = Path(".reuse/dep5").read_text(encoding="utf-8").splitlines()
          filtered = [line for line in dep5 if line.strip() != "tests/reuse_spdx_invalid.cpp"]
          Path(".reuse/dep5").write_text("\n".join(filtered) + "\n", encoding="utf-8")
          PY
      - name: REUSE lint (expected failure)
        shell: bash
        run: |
          set +e
          python3 -m reuse lint --suppress-deprecation
          status=$?
          set -e
          if [ $status -eq 0 ]; then
            echo "ERROR: REUSE lint was expected to fail but succeeded."
            exit 1
          fi
