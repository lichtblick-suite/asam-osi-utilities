# SPDX-License-Identifier: MPL-2.0
# Copyright (c) 2026, Bayerische Motoren Werke Aktiengesellschaft (BMW AG)
name: REUSE Compliance

on:
  pull_request:

jobs:
  reuse-lint:
    name: REUSE Lint
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v6
      - name: Provide SPDX license text
        shell: bash
        run: |
          mkdir -p LICENSES
          cp LICENSE LICENSES/MPL-2.0.txt
      - name: REUSE lint (expected success)
        uses: fsfe/reuse-action@v2
      - name: Enable invalid SPDX test file
        shell: bash
        run: |
          python3 - <<'PY'
          from pathlib import Path
          dep5 = Path(".reuse/dep5").read_text(encoding="utf-8").splitlines()
          filtered = [line for line in dep5 if line.strip() != "tests/reuse_spdx_invalid.cpp"]
          Path(".reuse/dep5").write_text("\n".join(filtered) + "\n", encoding="utf-8")
          PY
      - name: REUSE lint (expected failure)
        id: reuse_fail
        uses: fsfe/reuse-action@v2
        continue-on-error: true
      - name: Assert REUSE failure occurred
        if: steps.reuse_fail.outcome != 'failure'
        shell: bash
        run: |
          echo "ERROR: REUSE lint was expected to fail but succeeded."
          exit 1
