# SPDX-License-Identifier: MPL-2.0
# Copyright (c) 2026, Bayerische Motoren Werke Aktiengesellschaft (BMW AG)
name: REUSE Compliance

on:
  pull_request:

jobs:
  reuse-lint:
    name: REUSE Lint
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v6
      - name: Provide SPDX license text
        shell: bash
        run: |
          mkdir -p LICENSES
          cp LICENSE LICENSES/MPL-2.0.txt
      - name: Install reuse tool
        shell: bash
        run: |
          python3 -m pip install --user reuse
      - name: REUSE lint (expected success)
        shell: bash
        run: |
          python3 -m reuse lint
      - name: Enable invalid SPDX test folder
        shell: bash
        run: |
          python3 - <<'PY'
          from pathlib import Path
          import re
          path = Path("REUSE.toml")
          text = path.read_text(encoding="utf-8")
          text = re.sub(r'\\{\\s*path\\s*=\\s*"tests/intentional-failures/\\*\\*",\\s*exclude\\s*=\\s*true\\s*\\},?\\n?', "", text)
          path.write_text(text, encoding="utf-8")
          PY
      - name: REUSE lint (expected failure)
        shell: bash
        run: |
          set +e
          python3 -m reuse lint
          status=$?
          set -e
          if [ $status -eq 0 ]; then
            echo "ERROR: REUSE lint was expected to fail but succeeded."
            exit 1
          fi
